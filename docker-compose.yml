services:
  mc-dashboard:
    build: .
    ports:
      - "3001:3000"
    environment:
      - NEXT_PUBLIC_CONVEX_URL=${NEXT_PUBLIC_CONVEX_URL}
      - CONVEX_ADMIN_KEY=${CONVEX_ADMIN_KEY}
      - OPENCLAW_GATEWAY_WS=ws://host.docker.internal:18789
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - OPENCLAW_DEVICE_FILE=/workspace/kanban/.openclaw-device.json
      - WS_NO_BUFFER_UTIL=1
      - WORKSPACE_ROOT=/workspace
      - LIBC=glibc
      - CSS_TRANSFORMER_WASM=1
      - NEXT_DISABLE_TURBOPACK=1
    volumes:
      - ./:/app
      - /app/node_modules
      - /Users/m/.openclaw/workspace:/workspace:ro
    command: sh -c "npm install --include=optional && npm run dev"


  mc-runner:
    build: .
    environment:
      - WORKSPACE_ROOT=/workspace
      - MC_ACTIVITY_RUN_INTERVAL_MS=10000
      - MC_ACTIVITY_RUN_FALLBACK_MS=300000
      - MC_ACTIVITY_RUN_TIMEOUT_MS=300000
    volumes:
      - ./:/app
      - /app/node_modules
      - /Users/m/.openclaw/workspace:/workspace
    command: sh -c "npm install --include=optional && npm run run:mc-runner"
